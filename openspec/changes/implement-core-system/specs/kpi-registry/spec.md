## ADDED Requirements

### Requirement: KPI 主檔管理
系統 SHALL 提供 KPI 主檔管理功能，作為全系統的單一真相來源。每個 KPI 必須包含以下強制必填欄位：KPI_ID、KPI名稱、所屬BSC構面、定義、公式、資料來源、資料負責人、更新頻率、目標值、閾值、證據要求、適用計畫標籤。

#### Scenario: 建立新 KPI
- **WHEN** 使用者建立新 KPI
- **THEN** 系統要求填寫所有必填欄位
- **AND** 系統驗證 KPI_ID 唯一性
- **AND** 系統驗證公式格式正確性

#### Scenario: 查詢 KPI 定義
- **WHEN** 使用者查詢 KPI 定義
- **THEN** 系統顯示完整的定義、公式、資料來源資訊
- **AND** 系統顯示當前版本與歷史版本

#### Scenario: 更新 KPI 定義
- **WHEN** 使用者修改 KPI 定義、公式或閾值
- **THEN** 系統自動創建新版本
- **AND** 系統保留完整變更歷程（誰在何時改了什麼）
- **AND** 歷史數據自動關聯對應版本的 KPI 定義

### Requirement: 閾值模式設定
系統 SHALL 支援三種閾值模式：固定值、相對值（同比/環比）、預測偏離（進階功能）。系統 SHALL 允許為每個 KPI 設定閾值模板。

#### Scenario: 設定固定值閾值
- **WHEN** 使用者為 KPI 設定固定值閾值模式
- **THEN** 系統要求輸入綠燈、黃燈、紅燈的固定數值範圍
- **AND** 系統驗證範圍不重疊且邏輯正確

#### Scenario: 設定相對值閾值
- **WHEN** 使用者為 KPI 設定相對值閾值模式
- **THEN** 系統要求選擇比較基準（去年同期/上期）
- **AND** 系統要求輸入相對於基準的百分比範圍

#### Scenario: 自動計算交通燈號
- **WHEN** KPI 數值更新
- **THEN** 系統根據設定的閾值模式自動計算燈號
- **AND** 系統支援手動標記例外情況（需填寫說明）
- **AND** 燈號變更時自動通知相關責任人

### Requirement: 版本控管
系統 SHALL 為每個 KPI 維護完整的版本歷史，包括定義、公式、閾值的所有變更。

#### Scenario: 查看版本歷史
- **WHEN** 使用者查看 KPI 版本歷史
- **THEN** 系統顯示所有歷史版本
- **AND** 系統顯示每個版本的變更內容與變更人
- **AND** 系統允許比較不同版本的差異

#### Scenario: 關聯歷史數據
- **WHEN** 查詢歷史 KPI 數值
- **THEN** 系統自動關聯對應版本的 KPI 定義
- **AND** 系統使用該版本的閾值計算歷史燈號

