## ADDED Requirements

### Requirement: RBAC 角色管理
系統 SHALL 實作基於角色的存取控制（RBAC），包括系統管理員、國際長/副校長、處長/主任、組長、專員、跨單位顧問、知會對象等角色。

#### Scenario: 角色定義
- **WHEN** 系統管理員定義角色
- **THEN** 系統允許建立自訂角色
- **AND** 系統為每個角色指定權限範圍
- **AND** 系統支援角色繼承

#### Scenario: 指派角色
- **WHEN** 系統管理員指派角色給使用者
- **THEN** 系統允許為使用者指派多個角色
- **AND** 系統驗證角色權限不衝突
- **AND** 系統記錄角色指派歷史

### Requirement: Scope 資料範圍控制
系統 SHALL 實作 Scope 層級的資料範圍控制，包括全校、學院、系所、特定專案、特定學生群組。

#### Scenario: 設定資料範圍
- **WHEN** 系統管理員為使用者設定 Scope
- **THEN** 系統允許選擇 Scope 層級
- **AND** 系統允許指定具體範圍（如特定學院、系所）
- **AND** 系統驗證使用者只能存取範圍內的資料

#### Scenario: 跨 Scope 存取
- **WHEN** 使用者嘗試存取範圍外的資料
- **THEN** 系統拒絕存取並顯示錯誤訊息
- **AND** 系統記錄存取嘗試的稽核軌跡

### Requirement: 身份驗證
系統 SHALL 支援 SSO（Single Sign-On）校內帳號整合，選配 MFA（Multi-Factor Authentication）。

#### Scenario: SSO 登入
- **WHEN** 使用者透過 SSO 登入
- **THEN** 系統驗證 SSO Token
- **AND** 系統自動建立或更新使用者帳號
- **AND** 系統載入使用者的角色與 Scope

#### Scenario: MFA 驗證
- **WHEN** 系統啟用 MFA 且使用者登入
- **THEN** 系統要求提供第二驗證因子
- **AND** 系統驗證第二因子後才允許登入

### Requirement: 欄位級遮罩
系統 SHALL 依角色對敏感欄位進行遮罩，包括護照號、居留證號、家長聯絡方式等。

#### Scenario: 護照號遮罩
- **WHEN** 使用者查看包含護照號的資料
- **THEN** 系統依角色決定是否顯示完整號碼
- **AND** 無權限時顯示末四碼（如 ****1234）
- **AND** 有權限時顯示完整號碼

#### Scenario: 居留證號遮罩
- **WHEN** 使用者查看包含居留證號的資料
- **THEN** 系統依角色決定是否顯示完整號碼
- **AND** 無權限時顯示末六碼
- **AND** 有權限時顯示完整號碼

#### Scenario: 家長聯絡方式遮罩
- **WHEN** 使用者查看家長聯絡方式
- **THEN** 系統檢查使用者是否有特定權限
- **AND** 無權限時不顯示或部分遮罩
- **AND** 有權限時顯示完整資訊

### Requirement: 下載與匯出控管
系統 SHALL 控管資料下載與匯出，包括額外權限檢查、匯出記錄、禁止匯出欄位設定。

#### Scenario: 匯出資料
- **WHEN** 使用者嘗試匯出資料
- **THEN** 系統檢查使用者是否有匯出權限
- **AND** 系統檢查匯出的欄位是否允許匯出
- **AND** 系統記錄匯出操作到 Audit Log

#### Scenario: 禁止匯出欄位
- **WHEN** 系統管理員設定禁止匯出欄位
- **THEN** 系統允許為特定欄位設定「禁止匯出」標記
- **AND** 系統在匯出時自動排除這些欄位
- **AND** 系統顯示已排除欄位的提示

### Requirement: 完整稽核軌跡
系統 SHALL 記錄完整的稽核軌跡，包括查看記錄、匯出記錄、修改記錄，包含時間戳記與 IP 位址。

#### Scenario: 記錄查看
- **WHEN** 使用者查看敏感資料
- **THEN** 系統記錄：誰查看了哪筆資料、查看時間、IP 位址
- **AND** 系統儲存到 View Log

#### Scenario: 記錄匯出
- **WHEN** 使用者匯出資料
- **THEN** 系統記錄：誰匯出了什麼資料、匯出時間、IP 位址、匯出欄位
- **AND** 系統儲存到 Export Log

#### Scenario: 記錄修改
- **WHEN** 使用者修改資料
- **THEN** 系統記錄：誰修改了什麼欄位、修改前後內容、修改時間、IP 位址
- **AND** 系統儲存到 Edit Log

#### Scenario: 查詢稽核軌跡
- **WHEN** 系統管理員查詢稽核軌跡
- **THEN** 系統允許依時間、人員、操作類型、資料範圍篩選
- **AND** 系統支援匯出稽核報告
- **AND** 系統顯示完整的操作歷史

### Requirement: 個資合規檢查
系統 SHALL 提供個資合規檢查清單，包括資料蒐集目的告知、當事人同意書管理、資料保存期限管理、資料刪除請求處理。

#### Scenario: 資料蒐集目的告知
- **WHEN** 系統蒐集個資
- **THEN** 系統要求記錄蒐集目的
- **AND** 系統要求記錄告知時間與方式
- **AND** 系統記錄告知證明

#### Scenario: 同意書管理
- **WHEN** 系統需要當事人同意
- **THEN** 系統允許上傳同意書
- **AND** 系統記錄同意時間與範圍
- **AND** 系統追蹤同意書到期日

#### Scenario: 資料保存期限管理
- **WHEN** 系統設定資料保存期限
- **THEN** 系統允許為不同類型資料設定保存期限
- **AND** 系統在到期前提醒
- **AND** 系統在到期後自動標記待刪除

#### Scenario: 資料刪除請求處理
- **WHEN** 當事人請求刪除資料（GDPR Right to be Forgotten）
- **THEN** 系統允許提交刪除請求
- **AND** 系統驗證請求者身份
- **AND** 系統在核准後執行刪除並記錄

