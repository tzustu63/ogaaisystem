# Technical Design: 高等教育國際化策略執行管理系統

## Context
本系統為高等教育機構打造的三層式策略執行管理平台，需要整合多種管理方法論（BSC、OKR、RACI、Kanban、PDCA），並確保三層之間的連結為系統強制規則。

## Goals / Non-Goals

### Goals
- 建立可擴展的三層架構（戰略/戰術/執行）
- 實現系統強制的資料連結規則，避免人為疏漏
- 支援完整的稽核軌跡與資料治理
- 提供直觀的視覺化介面與導覽
- 確保個資安全與合規

### Non-Goals
- 不實作 AI/ML 預測功能（第三階段）
- 不實作移動應用（第三階段）
- 不實作跨校資料對標（第三階段）

## Decisions

### Decision 1: 技術棧選擇
**選擇**：
- 前端：React + TypeScript + Next.js
- 後端：Node.js + Express + TypeScript
- 資料庫：PostgreSQL
- 快取：Redis
- 檔案儲存：MinIO（可替換為 S3）
- 圖表：ECharts
- 工作流引擎：自建（基於狀態機）

**理由**：
- TypeScript 提供型別安全，適合複雜業務邏輯
- Next.js 支援 SSR，提升 SEO 與首屏載入速度
- PostgreSQL 支援 JSON 欄位，適合彈性資料結構
- 自建工作流引擎可完全控制邏輯，避免第三方限制

**替代方案**：
- 後端可選 Python/Django（團隊熟悉度考量）
- 工作流可選 Camunda（但增加複雜度）

### Decision 2: 資料庫設計原則
**選擇**：
- 使用關聯式資料庫為主
- 關鍵連結關係使用外鍵約束
- 版本控管使用版本表 + 時間戳記
- 稽核軌跡使用獨立表

**理由**：
- 外鍵約束確保資料完整性
- 版本表保留歷史，不影響現有資料查詢效能
- 獨立稽核表便於查詢與匯出

### Decision 3: 三層連結強制規則實作
**選擇**：
- 在資料庫層使用外鍵約束
- 在 API 層使用驗證中間件
- 在業務邏輯層使用強制檢查

**理由**：
- 多層防護確保資料一致性
- 資料庫層防止直接 SQL 操作繞過規則
- API 層提供明確錯誤訊息

### Decision 4: 工作流引擎設計
**選擇**：
- 基於狀態機的輕量級工作流引擎
- 工作流定義儲存在資料庫
- 支援條件分支與並行會簽

**理由**：
- 避免引入過重的工作流框架
- 資料庫儲存便於動態調整
- 滿足 RACI 工作流需求

### Decision 5: 權限模型實作
**選擇**：
- RBAC + Scope 雙層權限模型
- 權限檢查在 API 層統一處理
- 敏感欄位在前端與後端雙重遮罩

**理由**：
- 雙層模型支援複雜組織架構
- 統一檢查點避免遺漏
- 前端遮罩提升 UX，後端遮罩確保安全

## Risks / Trade-offs

### Risk 1: 系統複雜度高
**風險**：10 個模組相互關聯，開發與維護複雜
**緩解**：
- 採用模組化設計，明確介面定義
- 建立完整的測試覆蓋
- 分階段實施，先完成 MVP

### Risk 2: 效能問題
**風險**：大量資料時查詢與視覺化可能變慢
**緩解**：
- 使用 Redis 快取熱點資料
- 資料庫索引優化
- 分頁與懶載入
- 考慮資料倉儲（第二階段）

### Risk 3: 使用者抗拒
**風險**：使用者可能覺得系統過於複雜
**緩解**：
- 簡化操作流程
- 提供完整教育訓練
- 分階段導入，先從願意嘗試的單位開始

### Risk 4: 資料品質問題
**風險**：垃圾進垃圾出
**緩解**：
- 建立 DQ 檢核機制
- 可視化資料問題
- 設定資料負責人

## Migration Plan

### Phase 1: MVP 部署
1. 部署基礎架構
2. 匯入初始資料（KPI、Initiative）
3. 訓練核心使用者
4. 逐步擴大使用範圍

### Phase 2: 系統對接
1. 先對接學籍系統
2. 再對接財務系統
3. 最後對接人資系統

### Rollback Plan
- 保留舊系統並行運作 3 個月
- 資料可匯出備份
- 關鍵功能提供降級方案

## Open Questions
- SSO 整合的具體技術規格？
- 校內系統 API 規格是否已確定？
- 是否需要支援離線操作？
- 資料保留期限的具體要求？

